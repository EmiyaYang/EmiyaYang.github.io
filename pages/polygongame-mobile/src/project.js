require=function r(s,c,a){function l(e,t){if(!c[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(p)return p(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var i=c[e]={exports:{}};s[e][0].call(i.exports,function(t){return l(s[e][1][t]||t)},i,i.exports,r,s,c,a)}return c[e].exports}for(var p="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({Global:[function(t,e,n){"use strict";cc._RF.push(e,"a491dirUaZLsogpytawAC2x","Global"),window.Global={VT:[]},cc._RF.pop()},{}],Util:[function(t,e,n){"use strict";cc._RF.push(e,"fd526dPX3FMpa12rTOr4XnN","Util"),e.exports={randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},getBestPath:function(t){for(var r=[],s=[],e=0;e<t.length;e++)"string"==typeof t[e]?s.push(t[e]):r.push(t[e]);var g=r.length,c=void 0,m=void 0,v=void 0,a=1024,y=[],d=void 0,l=void 0;function p(t,e,n){for(var o=1;o<n;o++){var i=m[e][o][0],r=m[e][o][1],s=e+o;g<s&&(s%=g);var c=m[s][n-o][0],a=m[s][n-o][1],l=void 0,p=void 0;if("+"===v[s])l=r+a,p=i+c;else{var h=new Array(4);h[0]=i*c,h[1]=i*a,h[2]=r*a,h[3]=r*c,p=h[0],l=h[0];for(var u=1;u<4;u++)p>h[u]&&(p=h[u]),l<h[u]&&(l=h[u])}m[e][n][0]>p&&(m[e][n][0]=p),m[e][n][1]<l&&(m[e][n][1]=l,d[e][n]=o)}}return function(){(function(){m=new Array(g+1);for(var t=0;t<=g;t++){m[t]=new Array(g+1);for(var e=0;e<=g;e++)m[t][e]=new Array(2)}d=new Array(g+1);for(var n=0;n<=g;n++)d[n]=new Array(g+1);(c=new Array(g+1))[0]=0,(v=new Array(g+1))[0]=""})();for(var t=1;t<=g;t++)c[t]=r[t-1],v[t]=s[t-1];for(var e=1;e<=g;e++){var n=c[e],o=v[e];m[e][1][0]=Number(n),m[e][1][1]=Number(n);for(var i=2;i<=g;i++)m[e][i][0]=a,m[e][i][1]=-1*a;c[e]=Number(n),v[e]=o}(function(t){var e=void 0,n=void 0;for(n=2;n<=t;n++)for(e=1;e<=t;e++)p(0,e,n);var o=m[1][t][1],i=1;for(e=1;e<=t;e++)o<m[e][t][1]&&(o=m[e][t][1],i=e);d[0][0]=i,function t(e,n,o){var i=void 0;if(1!==o)for(var r=1;r<o;r++){var s=m[n][r][0],c=m[n][r][1],a=n+r;g<a&&(a%=g);var l=m[a][o-r][0],p=m[a][o-r][1];if("+"===v[a]){if(i=s+l,e===c+p){y.push(a),t(c,n,r),t(p,a,o-r);break}if(e===i){y.push(a),t(s,n,r),t(l,a,o-r);break}}else{var h=s*l,u=s*p,d=c*l,f=c*p;if(e===h){y.push(a),t(s,n,r),t(l,a,o-r);break}if(e===u){y.push(a),t(s,n,r),t(p,a,o-r);break}if(e===d){y.push(a),t(c,n,r),t(l,a,o-r);break}if(e===f){y.push(a),t(c,n,r),t(p,a,o-r);break}}}}(o,i,t),y.push(i),y.reverse(),console.log(y),console.log(o),l={path:y,score:o}})(g)}(),l}},cc._RF.pop()},{}],customGame:[function(t,e,n){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","customGame");t("Util");cc.Class({extends:cc.Component,properties:{polygon:{default:null,type:cc.Node}},onLoad:function(){this.polygon=cc.director.getScene().getChildByName("polygon")},onPlayBtnClick:function(){this.polygon.getComponent("polygon").updateVT(),cc.director.loadScene("playScene")},start:function(){},update:function(t){}}),cc._RF.pop()},{Util:"Util"}],line:[function(t,e,n){"use strict";cc._RF.push(e,"f5919d+YWxAlq+QKxXp5DTj","line"),cc.Class({extends:cc.Component,properties:{length:20,prior:null,next:null,operation:null},init:function(){this.prior=null,this.next=null,this.node.active=!0,this.node.opacity=255},getValue:function(){return this.operation},setOp:function(t){this.operation=t,this.node.color="*"===t?new cc.Color(255,255,255):new cc.Color(110,110,110)},drawLine:function(){if(this.prior&&this.next){if(this.prior.node.x&&this.prior.node.y&&this.next.node.x&&this.next.node.y){this.node.setPosition((this.prior.node.x+this.next.node.x)/2,(this.prior.node.y+this.next.node.y)/2);var t=this.prior.node.x-this.next.node.x,e=this.prior.node.y-this.next.node.y;this.node.rotation=0==t?90:Math.atan(-e/t)/2/Math.PI*360,this.node.width=Math.sqrt(t*t+e*e)}}else console.log("miss relate point")},onLoad:function(){this.node.on("touchend",function(t){t.stopPropagation(),t.currentTarget.parent.getComponent("polygon").onLineClick(t.currentTarget)})},start:function(){this.width=this.length},update:function(t){this.drawLine()}}),cc._RF.pop()},{}],nextBtn:[function(t,e,n){"use strict";cc._RF.push(e,"c4a14c8PXtMtKOL5xHlv67s","nextBtn"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this,e=cc.director.getScene().getChildByName("polygon");this.polygon=e.getComponent("polygon"),this.nodesArr=this.polygon.convertPathToNodes(),this.node.on("touchend",function(){t.polygon.onLineClick(t.nodesArr.shift().node)})},start:function(){}}),cc._RF.pop()},{}],playScene:[function(t,e,n){"use strict";cc._RF.push(e,"e49a49R94xHi5I3nJJHla8c","playScene"),cc.Class({extends:cc.Component,properties:{},onRollbackBtnClick:function(){this.polygon.rollback()},onGuideBtnClick:function(){cc.director.loadScene("presentScene"),this.polygon.ifNew=!0},onRestartBtnClick:function(){cc.director.loadScene("customGame"),this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=0},onLoad:function(){var t=cc.director.getScene().getChildByName("polygon");this.polygon=t.getComponent("polygon"),this.polygon.mode=1},start:function(){}}),cc._RF.pop()},{}],point:[function(t,e,n){"use strict";cc._RF.push(e,"673b0gcMS9DN7eHeUX0xM/e","point"),cc.Class({extends:cc.Component,properties:{valueLabel:{default:null,type:cc.Label},prior:null,next:null},init:function(){this.prior=null,this.next=null,this.node.active=!0,this.node.opacity=255,this.node.setScale(.1,.1)},setValue:function(t){this.val=t,this.valueLabel.string=t.toString()},getValue:function(){return parseInt(this.valueLabel.string)},onLoad:function(){this.node.on("touchend",function(t){t.stopPropagation(),t.currentTarget.parent.getComponent("polygon").onPointClick(t.currentTarget)})},start:function(){}}),cc._RF.pop()},{}],polygon:[function(t,e,n){"use strict";cc._RF.push(e,"fb83fHm4i1HB6UaD+EaoWvA","polygon");var o=t("Util");cc.Class({extends:cc.Component,properties:{pointPrefab:{default:null,type:cc.Prefab},linePrefab:{default:null,type:cc.Prefab},edgeNum:3,maxEdgeNum:12,minValue:-20,maxValue:20,VT:[],head:null,mode:0,slider:{default:null,type:cc.Slider},rollStack:[]},createPoint:function(t,e){var n=null;return(n=0<this.pointPool.size()?this.pointPool.get():cc.instantiate(this.pointPrefab)).setPosition(t,e),n.zIndex=10,n.parent=this.node,n.getComponent("point").init(),n},destoryPoint:function(t){this.pointPool.put(t)},createLine:function(){var t=null;return(t=0<this.linePool.size()?this.linePool.get():cc.instantiate(this.linePrefab)).parent=this.node,t.getComponent("line").init(),t},destoryLine:function(t){this.linePool.put(t)},generateVT:function(){for(var t=this.edgeNum,e=[];t--;)e.push(o.randomInt(0,1)?"*":"+"),e.push(o.randomInt(this.minValue,this.maxValue));this.VT=e},updateVT:function(){if(this.head){for(var t=this.head,e=[];e.push(t.getValue()),(t=t.next)&&t!==this.head;);return this.VT=e,this.VT}cc.warn("The head is null!")},clearCanvas:function(){for(var t=this.node.children.length;0<t--;)"line"===this.node.children[t].name?this.destoryLine(this.node.children[t]):"point"===this.node.children[t].name&&this.destoryPoint(this.node.children[t])},generatePolygon:function(){var t=void 0,e=void 0,n=void 0;"string"==typeof this.VT[0]?(n=this.createLine().getComponent("line")).setOp(this.VT[0]):(n=this.createPoint(0,0).getComponent("point")).setValue(this.VT[0]);e=n;for(var o=1;o<this.VT.length;o++){if("string"==typeof this.VT[o])(t=this.createLine().getComponent("line")).setOp(this.VT[o]);else(t=this.createPoint(1/3*320*Math.sin(2*o*Math.PI/this.VT.length),1/3*320*Math.cos(2*o*Math.PI/this.VT.length)).getComponent("point")).setValue(this.VT[o]);(e.next=t).prior=e,e=t}(e.next=n).prior=e,this.head=n},setPointValue:function(t){t.setValue()},onPointClick:function(t){if(0===this.mode){var e=t.getComponent("point");this.slider.getComponent("slider").setProgress(e,e.getValue(),this.minValue,this.maxValue)}else this.mode},breakLineAction:function(){return cc.rotateTo(2,90)},startRotation:function(){},rollback:function(){if(cc.log(this.rollStack),this.rollStack.length){var t=this.rollStack.pop();t||(t=this.rollStack.pop()),t.ifNew?(this.ifNew=!0,t.line.node.active=!0,t.line.node.runAction(cc.fadeIn(.2)),t.p0.next=t.line,t.p1.prior=t.line):(cc.log(t),t.p0.node.setPosition(t.p0PrePos),t.p1.node.setPosition(t.p1PrePos),t.p0.node.active=!0,t.p1.node.active=!0,t.line.node.active=!0,t.newPoint.node.destroy(),t.p0Line&&(t.p0Line.next=t.p0),t.p1Line&&(t.p1Line.prior=t.p1),this.resetHead())}},resetHead:function(){this.head.prior&&(this.head=this.head.prior)},onLineClick:function(e){var n=e.getComponent("line");if(0===this.mode){var t="*"===n.operation?"+":"*";n.setOp(t)}else{if(1!==this.mode&&2!==this.mode)return;if(this.ifNew||void 0===this.ifNew)this.ifNew=!1,this.rollStack.push({ifNew:!0,p0:n.prior,p1:n.next,line:n}),n.next.prior=null,n.prior.next=null,this.head=n.next,e.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){e.active=!1})));else{var o={p0:n.prior,p1:n.next,p0PrePos:n.prior.node.getPosition(),p1PrePos:n.next.node.getPosition(),line:n,p0Line:null,p1Line:null,newPoint:null};n.prior.node.runAction(cc.moveTo(.3,e.getPosition())),n.next.node.runAction(cc.sequence(cc.moveTo(.3,e.getPosition()),cc.callFunc(function(){var t=this.createPoint(e.x,e.y).getComponent("point");o.newPoint=t,"+"===n.operation?t.setValue(n.prior.getValue()+n.next.getValue()):t.setValue(n.prior.getValue()*n.next.getValue()),n.prior.node.active=!1,n.next.node.active=!1,e.active=!1,n.prior.prior?(o.p0Line=n.prior.prior,(n.prior.prior.next=t).prior=n.prior.prior):this.head=t,n.next.next&&(o.p1Line=n.next.next,(n.next.next.prior=t).next=n.next.next),this.rollStack.push(o),this.head.next||(cc.log("result!"),this.head.node.runAction(cc.spawn(cc.moveTo(.7,cc.p(0,0)).easing(cc.easeElasticInOut(.5)),cc.scaleTo(.5,.2,.2).easing(cc.easeElasticInOut(.5)))))},this)))}}},convertPathToNodes:function(){var t=o.getBestPath(this.VT).path;cc.log(t);for(var e=[],n=0;n<t.length;n++)e.push(this.findLineNode(t[n]-1));return e},findLineNode:function(t){t<0&&cc.warn("Line serial can't be positive"),"line"!==this.head.node.name&&cc.warn("The first node has to be line.");for(var e=this.head;t--&&e;)e=e.next.next;return e},onLoad:function(){cc.game.addPersistRootNode(this.node),this.generateVT(),this.pointPool=new cc.NodePool,this.linePool=new cc.NodePool;for(var t=0;t<this.maxEdgeNum;++t)this.pointPool.put(cc.instantiate(this.pointPrefab)),this.linePool.put(cc.instantiate(this.linePrefab))},start:function(){this.pointPool&&this.VT||this.onLoad(),this.ifNew=!0,this.generatePolygon()}}),cc._RF.pop()},{Util:"Util"}],presentScene:[function(t,e,n){"use strict";cc._RF.push(e,"fd8e3oYZv5J1rSzrpvSOqMd","presentScene");t("Util");cc.Class({extends:cc.Component,properties:{},onRestartBtnClick:function(){cc.director.loadScene("customGame"),this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=0},onLoad:function(){var t=cc.director.getScene().getChildByName("polygon");this.polygon=t.getComponent("polygon")},start:function(){this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=2}}),cc._RF.pop()},{Util:"Util"}],rollbacBtn:[function(t,e,n){"use strict";cc._RF.push(e,"fbaf8/tOlFJ44CZrI9+CT3D","rollbacBtn"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],slider:[function(t,e,n){"use strict";cc._RF.push(e,"758068/sR9MGafNeZvxVSFp","slider"),cc.Class({extends:cc.Component,properties:{slider:cc.Slider,polygon:{default:null,type:cc.Node},canvas:{default:null,type:cc.Node},pointEditMode:!1,bindedPoint:null},setProgress:function(t,e,n,o){this.min=n,(this.max=o)<=n||e<n||o<e?cc.warn("Progress 重设有误。"):(this.bindedPoint=t,this.node.getComponent(cc.Slider).progress=Math.abs((e-n)/(o-n)),this.pointEditMode=!0)},onLoad:function(){var t=this;this.polygon=cc.director.getScene().getChildByName("polygon"),this.node.getComponent(cc.Slider).progress=Math.abs((this.polygon.getComponent("polygon").edgeNum-3)/(this.polygon.getComponent("polygon").maxEdgeNum-3)),this.slider.node.on("slide",this.callback,this),this.canvas.on("touchend",function(){t.pointEditMode=!1,t.node.getComponent(cc.Slider).progress=Math.abs((t.polygon.getComponent("polygon").edgeNum-3)/(t.polygon.getComponent("polygon").maxEdgeNum-3))})},callback:function(t,e){if(t.progress)if(this.pointEditMode)this.bindedPoint.setValue(Math.floor(t.progress*(this.max-this.min))+this.min);else{var n=this.polygon.getComponent("polygon");n.edgeNum=Math.floor(t.progress*(n.maxEdgeNum-3))+3,n.generateVT(),n.clearCanvas(),n.generatePolygon()}},start:function(){}}),cc._RF.pop()},{}]},{},["Global","Util","customGame","line","nextBtn","playScene","point","polygon","presentScene","rollbacBtn","slider"]);