require=function r(s,c,a){function l(t,e){if(!c[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(p)return p(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=c[t]={exports:{}};s[t][0].call(i.exports,function(e){return l(s[t][1][e]||e)},i,i.exports,r,s,c,a)}return c[t].exports}for(var p="function"==typeof require&&require,e=0;e<a.length;e++)l(a[e]);return l}({Global:[function(e,t,n){"use strict";cc._RF.push(t,"a491dirUaZLsogpytawAC2x","Global"),window.Global={VT:[]},cc._RF.pop()},{}],Util:[function(e,t,n){"use strict";cc._RF.push(t,"fd526dPX3FMpa12rTOr4XnN","Util"),t.exports={randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getBestPath:function(e){for(var r=[],s=[],t=0;t<e.length;t++)"string"==typeof e[t]?s.push(e[t]):r.push(e[t]);var g=r.length,c=void 0,v=void 0,m=void 0,a=1024,x=[],d=void 0,l=void 0;function p(e,t,n){for(var o=1;o<n;o++){var i=v[t][o][0],r=v[t][o][1],s=t+o;g<s&&(s%=g);var c=v[s][n-o][0],a=v[s][n-o][1],l=void 0,p=void 0;if("+"===m[s])l=r+a,p=i+c;else{var h=new Array(4);h[0]=i*c,h[1]=i*a,h[2]=r*a,h[3]=r*c,p=h[0],l=h[0];for(var u=1;u<4;u++)p>h[u]&&(p=h[u]),l<h[u]&&(l=h[u])}v[t][n][0]>p&&(v[t][n][0]=p),v[t][n][1]<l&&(v[t][n][1]=l,d[t][n]=o)}}return function(){(function(){v=new Array(g+1);for(var e=0;e<=g;e++){v[e]=new Array(g+1);for(var t=0;t<=g;t++)v[e][t]=new Array(2)}d=new Array(g+1);for(var n=0;n<=g;n++)d[n]=new Array(g+1);(c=new Array(g+1))[0]=0,(m=new Array(g+1))[0]=""})();for(var e=1;e<=g;e++)c[e]=r[e-1],m[e]=s[e-1];for(var t=1;t<=g;t++){var n=c[t],o=m[t];v[t][1][0]=Number(n),v[t][1][1]=Number(n);for(var i=2;i<=g;i++)v[t][i][0]=a,v[t][i][1]=-1*a;c[t]=Number(n),m[t]=o}(function(e){var t=void 0,n=void 0;for(n=2;n<=e;n++)for(t=1;t<=e;t++)p(0,t,n);var o=v[1][e][1],i=1;for(t=1;t<=e;t++)o<v[t][e][1]&&(o=v[t][e][1],i=t);d[0][0]=i,function e(t,n,o){var i=void 0;if(1!==o)for(var r=1;r<o;r++){var s=v[n][r][0],c=v[n][r][1],a=n+r;g<a&&(a%=g);var l=v[a][o-r][0],p=v[a][o-r][1];if("+"===m[a]){if(i=s+l,t===c+p){x.push(a),e(c,n,r),e(p,a,o-r);break}if(t===i){x.push(a),e(s,n,r),e(l,a,o-r);break}}else{var h=s*l,u=s*p,d=c*l,f=c*p;if(t===h){x.push(a),e(s,n,r),e(l,a,o-r);break}if(t===u){x.push(a),e(s,n,r),e(p,a,o-r);break}if(t===d){x.push(a),e(c,n,r),e(l,a,o-r);break}if(t===f){x.push(a),e(c,n,r),e(p,a,o-r);break}}}}(o,i,e),x.push(i),x.reverse(),console.log(x),console.log(o),l={path:x,score:o}})(g)}(),l}},cc._RF.pop()},{}],customGame:[function(e,t,n){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","customGame");e("Util");cc.Class({extends:cc.Component,properties:{polygon:{default:null,type:cc.Node}},onLoad:function(){this.polygon=cc.director.getScene().getChildByName("polygon")},onPlayBtnClick:function(){this.polygon.getComponent("polygon").updateVT(),cc.director.loadScene("playScene")},start:function(){},update:function(e){}}),cc._RF.pop()},{Util:"Util"}],line:[function(e,t,n){"use strict";cc._RF.push(t,"f5919d+YWxAlq+QKxXp5DTj","line"),cc.Class({extends:cc.Component,properties:{length:20,prior:null,next:null,operation:null},init:function(){this.prior=null,this.next=null,this.node.active=!0,this.node.opacity=255},getValue:function(){return this.operation},setOp:function(e){this.operation=e,this.node.color="*"===e?new cc.Color(255,255,255):new cc.Color(110,110,110)},drawLine:function(){if(this.prior&&this.next){if(this.prior.node.x&&this.prior.node.y&&this.next.node.x&&this.next.node.y){this.node.setPosition((this.prior.node.x+this.next.node.x)/2,(this.prior.node.y+this.next.node.y)/2);var e=this.prior.node.x-this.next.node.x,t=this.prior.node.y-this.next.node.y;this.node.rotation=0==e?90:Math.atan(-t/e)/2/Math.PI*360,this.node.width=Math.sqrt(e*e+t*t)}}else console.log("miss relate point")},onLoad:function(){this.node.on("touchend",function(e){e.stopPropagation(),e.currentTarget.parent.getComponent("polygon").onLineClick(e.currentTarget)})},start:function(){this.width=this.length},update:function(e){this.drawLine()}}),cc._RF.pop()},{}],nextBtn:[function(e,t,n){"use strict";cc._RF.push(t,"c4a14c8PXtMtKOL5xHlv67s","nextBtn"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this,t=cc.director.getScene().getChildByName("polygon");this.polygon=t.getComponent("polygon"),this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=2,this.nodesArr=this.polygon.convertPathToNodes(),this.node.on("touchend",function(){0!==e.nodesArr.length&&e.polygon.onPresent(e.nodesArr.shift().node)})},start:function(){}}),cc._RF.pop()},{}],playScene:[function(e,t,n){"use strict";cc._RF.push(t,"e49a49R94xHi5I3nJJHla8c","playScene"),cc.Class({extends:cc.Component,properties:{},onRollbackBtnClick:function(){this.polygon.rollback()},onGuideBtnClick:function(){cc.director.loadScene("presentScene"),this.polygon.ifNew=!0},onRestartBtnClick:function(){cc.director.loadScene("customGame"),this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=0},onLoad:function(){var e=cc.director.getScene().getChildByName("polygon");this.polygon=e.getComponent("polygon"),this.polygon.mode=1},start:function(){}}),cc._RF.pop()},{}],point:[function(e,t,n){"use strict";cc._RF.push(t,"673b0gcMS9DN7eHeUX0xM/e","point"),cc.Class({extends:cc.Component,properties:{valueLabel:{default:null,type:cc.Label},prior:null,next:null,_selected:!1},init:function(){this.prior=null,this.next=null,this.node.active=!0,this.node.opacity=255,this.selected=!1},setValue:function(e){this.val=e,this.valueLabel.string=e.toString()},getValue:function(){return parseInt(this.valueLabel.string)},select:function(){this.selected=!0},unSelect:function(){this.selected=!1},onLoad:function(){this.node.on("touchend",function(e){e.stopPropagation(),e.currentTarget.parent.getComponent("polygon").onPointClick(e.currentTarget)}),Object.defineProperty(this,"selected",{get:function(){return this._selected},set:function(e){(this._selected=e)?this.node.setScale(.12,.12):this.node.setScale(.1,.1)}})},start:function(){}}),cc._RF.pop()},{}],polygon:[function(e,t,n){"use strict";cc._RF.push(t,"fb83fHm4i1HB6UaD+EaoWvA","polygon");var o=e("Util");cc.Class({extends:cc.Component,properties:{pointPrefab:{default:null,type:cc.Prefab},linePrefab:{default:null,type:cc.Prefab},edgeNum:3,maxEdgeNum:12,minValue:-20,maxValue:20,VT:[],head:null,mode:0,slider:{default:null,type:cc.Slider},rollStack:[]},createPoint:function(e,t){var n=null;return(n=0<this.pointPool.size()?this.pointPool.get():cc.instantiate(this.pointPrefab)).setPosition(e,t),n.zIndex=10,n.parent=this.node,n.getComponent("point").init(),n},destoryPoint:function(e){this.pointPool.put(e)},createLine:function(){var e=null;return(e=0<this.linePool.size()?this.linePool.get():cc.instantiate(this.linePrefab)).parent=this.node,e.getComponent("line").init(),e},destoryLine:function(e){this.linePool.put(e)},generateVT:function(){for(var e=this.edgeNum,t=[];e--;)t.push(o.randomInt(0,1)?"*":"+"),t.push(o.randomInt(this.minValue,this.maxValue));this.VT=t},updateVT:function(){if(this.head){for(var e=this.head,t=[];t.push(e.getValue()),(e=e.next)&&e!==this.head;);return this.VT=t,this.VT}cc.warn("The head is null!")},clearCanvas:function(){for(var e=this.node.children.length;0<e--;)"line"===this.node.children[e].name?this.destoryLine(this.node.children[e]):"point"===this.node.children[e].name&&this.destoryPoint(this.node.children[e])},generatePolygon:function(){var e=void 0,t=void 0,n=void 0;"string"==typeof this.VT[0]?(n=this.createLine().getComponent("line")).setOp(this.VT[0]):(n=this.createPoint(0,0).getComponent("point")).setValue(this.VT[0]);t=n;for(var o=1;o<this.VT.length;o++){if("string"==typeof this.VT[o])(e=this.createLine().getComponent("line")).setOp(this.VT[o]);else(e=this.createPoint(1/3*320*Math.sin(2*o*Math.PI/this.VT.length),1/3*320*Math.cos(2*o*Math.PI/this.VT.length)).getComponent("point")).setValue(this.VT[o]);(t.next=e).prior=t,t=e}(t.next=n).prior=t,this.head=n},setPointValue:function(e){e.setValue()},onPointClick:function(e){if(0===this.mode){var t=e.getComponent("point");t.select(),this.slider.getComponent("slider").setProgress(t,t.getValue(),this.minValue,this.maxValue)}else this.mode},breakLineAction:function(){return cc.rotateTo(2,90)},startRotation:function(){},rollback:function(){if(this.rollStack.length){var e=this.rollStack.pop();e||(e=this.rollStack.pop()),e.ifNew?(this.ifNew=!0,this.head=e.line,e.line.node.active=!0,e.line.node.runAction(cc.fadeIn(.2)),e.p0.next=e.line,e.p1.prior=e.line):(e.p0.node.setPosition(e.p0PrePos),e.p1.node.setPosition(e.p1PrePos),e.p0.node.active=!0,e.p1.node.active=!0,e.line.node.active=!0,this.destoryPoint(e.newPoint.node),e.p0Line&&(e.p0Line.next=e.p0),e.p1Line&&(e.p1Line.prior=e.p1),this.resetHead())}},resetHead:function(){this.head.prior&&(this.head=this.head.prior)},onLineClick:function(t){var n=t.getComponent("line");if(0===this.mode){var e="*"===n.operation?"+":"*";n.setOp(e)}else{if(1!==this.mode)return;if(this.ifNew||void 0===this.ifNew)this.ifNew=!1,this.rollStack.push({ifNew:!0,p0:n.prior,p1:n.next,line:n}),n.next.prior=null,n.prior.next=null,this.head=n.next,t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1})));else{var o={p0:n.prior,p1:n.next,p0PrePos:n.prior.node.getPosition(),p1PrePos:n.next.node.getPosition(),line:n,p0Line:null,p1Line:null,newPoint:null};n.prior.node.runAction(cc.moveTo(.3,t.getPosition())),n.next.node.runAction(cc.sequence(cc.moveTo(.3,t.getPosition()),cc.callFunc(function(){var e=this.createPoint(t.x,t.y).getComponent("point");o.newPoint=e,"+"===n.operation?e.setValue(n.prior.getValue()+n.next.getValue()):e.setValue(n.prior.getValue()*n.next.getValue()),n.prior.node.active=!1,n.next.node.active=!1,t.active=!1,n.prior.prior?(o.p0Line=n.prior.prior,(n.prior.prior.next=e).prior=n.prior.prior):this.head=e,n.next.next&&(o.p1Line=n.next.next,(n.next.next.prior=e).next=n.next.next),this.rollStack.push(o),this.head.next||(cc.log("result!"),this.head.node.runAction(cc.spawn(cc.moveTo(.7,cc.p(0,0)).easing(cc.easeElasticInOut(.5)),cc.scaleTo(.5,.2,.2).easing(cc.easeElasticInOut(.5)))))},this)))}}},onPresent:function(t){var n=t.getComponent("line");if(this.ifNew||void 0===this.ifNew)this.ifNew=!1,this.rollStack.push({ifNew:!0,p0:n.prior,p1:n.next,line:n}),n.next.prior=null,n.prior.next=null,this.head=n.next,t.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){t.active=!1})));else{var o={p0:n.prior,p1:n.next,p0PrePos:n.prior.node.getPosition(),p1PrePos:n.next.node.getPosition(),line:n,p0Line:null,p1Line:null,newPoint:null};n.prior.node.runAction(cc.moveTo(.3,t.getPosition())),n.next.node.runAction(cc.sequence(cc.moveTo(.3,t.getPosition()),cc.callFunc(function(){var e=this.createPoint(t.x,t.y).getComponent("point");o.newPoint=e,"+"===n.operation?e.setValue(n.prior.getValue()+n.next.getValue()):e.setValue(n.prior.getValue()*n.next.getValue()),n.prior.node.active=!1,n.next.node.active=!1,t.active=!1,n.prior.prior?(o.p0Line=n.prior.prior,(n.prior.prior.next=e).prior=n.prior.prior):this.head=e,n.next.next&&(o.p1Line=n.next.next,(n.next.next.prior=e).next=n.next.next),this.rollStack.push(o),this.head.next||(cc.log("result!"),this.head.node.runAction(cc.spawn(cc.moveTo(.7,cc.p(0,0)).easing(cc.easeElasticInOut(.5)),cc.scaleTo(.5,.2,.2).easing(cc.easeElasticInOut(.5)))))},this)))}},convertPathToNodes:function(){var e=o.getBestPath(this.VT).path;cc.log(e);for(var t=[],n=0;n<e.length;n++)t.push(this.findLineNode(e[n]-1));return t},findLineNode:function(e){e<0&&cc.warn("Line serial can't be positive"),"line"!==this.head.node.name&&cc.warn("The first node has to be line.");for(var t=this.head;e--&&t;)t=t.next.next;return t},onLoad:function(){cc.game.addPersistRootNode(this.node),this.generateVT(),this.pointPool=new cc.NodePool,this.linePool=new cc.NodePool;for(var e=0;e<this.maxEdgeNum;++e)this.pointPool.put(cc.instantiate(this.pointPrefab)),this.linePool.put(cc.instantiate(this.linePrefab))},start:function(){this.pointPool&&this.VT||this.onLoad(),this.ifNew=!0,this.generatePolygon()}}),cc._RF.pop()},{Util:"Util"}],presentScene:[function(e,t,n){"use strict";cc._RF.push(t,"fd8e3oYZv5J1rSzrpvSOqMd","presentScene");e("Util");cc.Class({extends:cc.Component,properties:{},onRestartBtnClick:function(){cc.director.loadScene("customGame"),this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=0},onLoad:function(){var e=cc.director.getScene().getChildByName("polygon");this.polygon=e.getComponent("polygon")},start:function(){this.polygon.clearCanvas(),this.polygon.start(),this.polygon.mode=2}}),cc._RF.pop()},{Util:"Util"}],rollbacBtn:[function(e,t,n){"use strict";cc._RF.push(t,"fbaf8/tOlFJ44CZrI9+CT3D","rollbacBtn"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],slider:[function(e,t,n){"use strict";cc._RF.push(t,"758068/sR9MGafNeZvxVSFp","slider"),cc.Class({extends:cc.Component,properties:{slider:cc.Slider,polygon:{default:null,type:cc.Node},canvas:{default:null,type:cc.Node},pointEditMode:!1,bindedPoint:null},setProgress:function(e,t,n,o){this.min=n,(this.max=o)<=n||t<n||o<t?cc.warn("Progress 重设有误。"):(this.bindedPoint&&this.bindedPoint.unSelect(),this.bindedPoint=e,this.node.getComponent(cc.Slider).progress=Math.abs((t-n)/(o-n)),this.pointEditMode=!0)},onLoad:function(){var e=this;this.polygon=cc.director.getScene().getChildByName("polygon"),this.node.getComponent(cc.Slider).progress=Math.abs((this.polygon.getComponent("polygon").edgeNum-3)/(this.polygon.getComponent("polygon").maxEdgeNum-3)),this.slider.node.on("slide",this.callback,this),this.canvas.on("touchend",function(){e.bindedPoint&&e.bindedPoint.unSelect(),e.pointEditMode=!1,e.node.getComponent(cc.Slider).progress=Math.abs((e.polygon.getComponent("polygon").edgeNum-3)/(e.polygon.getComponent("polygon").maxEdgeNum-3))})},callback:function(e,t){if(e.progress)if(this.pointEditMode)this.bindedPoint.setValue(Math.floor(e.progress*(this.max-this.min))+this.min);else{var n=this.polygon.getComponent("polygon");n.edgeNum=Math.floor(e.progress*(n.maxEdgeNum-3))+3,n.generateVT(),n.clearCanvas(),n.generatePolygon()}},start:function(){},onDestroy:function(){this.bindedPoint&&this.bindedPoint.unSelect()}}),cc._RF.pop()},{}]},{},["Global","Util","customGame","line","nextBtn","playScene","point","polygon","presentScene","rollbacBtn","slider"]);